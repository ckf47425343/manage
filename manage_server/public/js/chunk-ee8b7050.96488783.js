(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ee8b7050"],{"32e1":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"postform"},[a("div",{staticClass:"title"},[e._v("发布商品")]),a("div",{staticClass:"postform_content"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"商品名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请你输入商品"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),a("el-form-item",{attrs:{label:"商品类型",prop:"type_id"}},[a("el-select",{attrs:{placeholder:"请你选择商品类型"},model:{value:e.ruleForm.type_id,callback:function(t){e.$set(e.ruleForm,"type_id",t)},expression:"ruleForm.type_id"}},e._l(e.productType,(function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.typeId}})})),1)],1),a("el-form-item",{attrs:{label:"商品图片",prop:"img"}},[a("UploadFile",{attrs:{"img-src":e.ruleForm.img},on:{upload:function(t){return e.uploadVal(t,"img")}}})],1),a("el-form-item",{attrs:{label:"详情图片",prop:"detail_img"}},[a("UploadFile",{attrs:{"img-src":e.ruleForm.detail_img},on:{upload:function(t){return e.uploadVal(t,"detail_img")}}})],1),a("el-form-item",{attrs:{label:"商品价钱",prop:"price"}},[a("el-input",{staticClass:"price_input",attrs:{placeholder:"请你输入商品价格"},model:{value:e.ruleForm.price,callback:function(t){e.$set(e.ruleForm,"price",t)},expression:"ruleForm.price"}},[a("template",{slot:"append"},[e._v("元/斤")])],2)],1),a("el-form-item",{attrs:{label:"库存量",prop:"save_count"}},[a("el-input",{staticClass:"price_input",attrs:{placeholder:"请输入库存总量"},model:{value:e.ruleForm.save_count,callback:function(t){e.$set(e.ruleForm,"save_count",t)},expression:"ruleForm.save_count"}})],1),a("el-form-item",{attrs:{label:"商品状态",prop:"status"}},[a("el-radio-group",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[a("el-radio",{attrs:{label:"上架"}}),a("el-radio",{attrs:{label:"下架"}})],1)],1),a("el-form-item",{attrs:{label:"商品描述",prop:"desc"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.desc,callback:function(t){e.$set(e.ruleForm,"desc",t)},expression:"ruleForm.desc"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.postProduct("ruleForm")}}},[e._v("提交商品")])],1)],1)],1)])},s=[],o=(a("ac1f"),a("5319"),a("ee9b"),a("8a99")),i={name:"PostProduct",created:function(){var e=this.$route.query.pid;e?(this.pid=e,this.title="商品详情",this.getProductById(e)):this.title="发布商品",this.getTypeData(),console.log("query==>",this.$route)},data:function(){return{title:"",productType:[],pid:"",ruleForm:{name:"",type_id:"",price:"",status:"",save_count:"",desc:"",img:"",detail_img:""},copyRuleForm:{},types:{imgType:"",detailImgType:""},rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],type:[{required:!0,message:"请选择商品类型",trigger:"change"}],price:[{validator:this.validfomat,required:!0,trigger:"change"}],img:[{required:!0,message:"请上传图片",trigger:"change"}],detail_img:[{required:!0,message:"请上传详情图片",trigger:"change"}],save_count:[{validator:this.validfomat,required:!0,trigger:"change"}],status:[{required:!0,message:"请选择商品状态",trigger:"change"}],desc:[{required:!0,message:"请填写活动形式",trigger:"blur"}]}}},methods:{getTypeData:function(){var e=this;console.log(this),this.axios({method:"GET",url:this.baseUrl+"/type"}).then((function(t){console.log("res==>",t),1050==t.data.status&&(e.productType=t.data.result)})).catch((function(e){console.log("err=>",e)}))},validfomat:function(e,t,a){console.log(t,e);var r=/(^[1-9]\d*(\.\d{1,2})?$)|(^0(\.\d{1,2})?$)/;return t?(console.log(r.test(t)),r.test(t)?void a():a(new Error("格式错误"))):a(new Error("不能为空"))},postProduct:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.pid?t.update():t.post()}))},post:function(){var e=this,t=Object.assign({},this.ruleForm,this.types);t.img=t.img.replace(/data:image\/[a-z]+;base64,/,""),t.detail_img=t.detail_img.replace(/data:image\/[a-z]+;base64,/,""),this.axios({method:"POST",url:this.baseUrl+"/postProduct",data:t,headers:{token:document.cookie}}).then((function(t){1034==t.data.status&&(e.$message({message:t.data.msg,type:"error"}),setTimeout((function(){e.$router.push({name:"Login"})}),1e3)),1060==t.data.status&&(e.$message({message:t.data.msg,type:"success"}),e.ruleForm={}),1061==t.data.status&&e.$message({message:t.data.msg,type:"error"})})).catch((function(e){console.log(e)}))},update:function(){var e=this,t={};for(var a in this.ruleForm)this.ruleForm[a]!=this.copyRuleForm[a]&&(t[a]=this.ruleForm[a]);if(t.img&&(t.img=t.img.replace(/data:image\/[a-z]+;base64,/,""),t.imgType=this.types.imgType),t.detail_img&&(t.detail_img=t.detail_img.replace(/data:image\/[a-z]+;base64,/,""),t.detailImgType=this.types.detailImgType),"{}"==JSON.stringify(t))return this.$message({message:"你尚未更改商品信息",type:"warning"});t.pid=this.pid,this.axios({method:"POST",url:this.baseUrl+"/updateProduct",data:t,headers:{token:document.cookie}}).then((function(t){1034==t.data.status&&(e.$message({message:t.data.msg,type:"error"}),setTimeout((function(){e.$router.push({name:"Login"})}),1e3)),1100==t.data.status&&(e.$message({message:t.data.msg,type:"success"}),e.getProductById(e.pid))})).catch((function(t){console.log("test"),e.$message({message:"商品更新失败",type:"error"})}))},uploadVal:function(e,t){console.log("type=>",t),console.log("e==>",e),"img"==t?(console.log(e.base64),this.ruleForm.img=e.base64,this.types.imgType=e.type):(this.ruleForm.detail_img=e.base64,this.types.detailImgType=e.type)},getProductById:function(e){var t=this;this.axios({method:"GET",url:this.baseUrl+"/probyid",params:{pid:e},headers:{token:document.cookie}}).then((function(e){if(console.log("result===>",e.data),1034==e.data.status&&(t.$message({message:e.data.msg,type:"error"}),setTimeout((function(){t.$router.push({name:"Login"})}),1e3)),1070==e.data.status){var a=e.data.url,r=e.data.result[0];for(var s in r.img=a+"/"+r.img,r.detail_img=a+"/"+r.detail_img,t.ruleForm)t.ruleForm[s]=r[s];t.copyRuleForm=Object.assign({},t.ruleForm),console.log("data==>",r)}})).catch((function(e){console.log("error",e)}))}},components:{UploadFile:o["a"]}},l=i,u=a("2877"),m=Object(u["a"])(l,r,s,!1,null,"6b545fd5",null);t["default"]=m.exports},ee9b:function(e,t,a){}}]);
//# sourceMappingURL=chunk-ee8b7050.96488783.js.map